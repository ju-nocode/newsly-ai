<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Paramètres - Newsly AI</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>✏️</text></svg>">

    <!-- Critical: Theme initialization BEFORE any CSS to prevent flash -->
    <script>(function(){const t=localStorage.getItem('theme')||'dark';document.documentElement.setAttribute('data-theme',t);document.documentElement.classList.add(t);})();</script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="public/css/settings-main.css">
    <script src="public/js/browser-detect.js"></script>
    <script type="module" src="public/js/icons8-icons.js"></script>
</head>
<body class="dashboard-body">

    <!-- Overlay pour menu mobile -->
    <div class="mobile-overlay" id="mobileOverlay"></div>

    <!-- Navbar will be injected here by navbar-component.js -->

    <!-- Vertical Sidebar - Collapsible -->
    <aside class="vertical-sidebar">
        <div class="sidebar-content">
            <!-- Paramètres du compte -->
            <div class="sidebar-section">
                <h3 class="sidebar-section-title" data-i18n="settings.accountSettings">Paramètres du compte</h3>
                <ul class="sidebar-menu">
                    <li class="sidebar-menu-item">
                        <a class="sidebar-menu-link active" href="#" data-section="profile" data-tooltip="Profil">
                            <img src="https://img.icons8.com/ios-filled/18/user.png" alt="" class="sidebar-icon">
                            <span data-i18n="settings.profile">Profil</span>
                        </a>
                    </li>
                    <li class="sidebar-menu-item">
                        <a class="sidebar-menu-link" href="#" data-section="preferences" data-tooltip="Préférences">
                            <img src="https://img.icons8.com/ios-filled/18/settings-3.png" alt="" class="sidebar-icon">
                            <span data-i18n="settings.preferences">Préférences</span>
                        </a>
                    </li>
                    <li class="sidebar-menu-item">
                        <a class="sidebar-menu-link" href="#" data-section="account" data-tooltip="Compte">
                            <img src="https://img.icons8.com/ios-filled/18/user-male-circle.png" alt="" class="sidebar-icon">
                            <span data-i18n="settings.account">Compte</span>
                        </a>
                    </li>
                    <li class="sidebar-menu-item">
                        <a class="sidebar-menu-link" href="#" data-section="security" data-tooltip="Sécurité">
                            <img src="https://img.icons8.com/ios-filled/18/security-checked.png" alt="" class="sidebar-icon">
                            <span data-i18n="settings.security">Sécurité</span>
                        </a>
                    </li>
                </ul>
            </div>

            <!-- Navigation -->
            <div class="sidebar-section">
                <h3 class="sidebar-section-title">Navigation</h3>
                <ul class="sidebar-menu">
                    <li class="sidebar-menu-item">
                        <a class="sidebar-menu-link" href="dashboard.html" data-tooltip="Dashboard">
                            <img src="https://img.icons8.com/ios-filled/18/dashboard.png" alt="" class="sidebar-icon">
                            <span data-i18n="nav.dashboard">Dashboard</span>
                        </a>
                    </li>
                    <li class="sidebar-menu-item">
                        <a class="sidebar-menu-link" href="#" id="sidebarLogoutBtn" data-tooltip="Déconnexion">
                            <img src="https://img.icons8.com/ios-filled/18/exit.png" alt="" class="sidebar-icon">
                            <span data-i18n="nav.logout">Déconnexion</span>
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </aside>

    <!-- Main Content -->
    <div class="settings-layout">

        <!-- Content Area -->
        <div class="settings-content">
            <!-- Profile Section -->
            <section id="section-profile" class="settings-section active">
                <h2 class="settings-section-title" data-i18n="settings.profile">Profil</h2>
                <p class="settings-section-desc" data-i18n="settings.manageProfile">Gérez vos informations personnelles</p>

                <!-- Profile Card - Single unified card -->
                <div class="settings-card">
                    <div class="profile-header">
                        <div>
                            <h3 class="settings-card-title" data-i18n="settings.profile">Profil</h3>
                            <div class="profile-meta">
                                <span id="accountCreatedAt">Compte créé le ...</span>
                                <span class="meta-separator">•</span>
                                <span id="accountUpdatedAt">Mis à jour le ...</span>
                            </div>
                        </div>

                        <!-- Avatar in header -->
                        <div class="profile-avatar-header">
                            <div class="avatar-preview" id="avatarPreview">
                                <img id="avatarImage" src="https://ui-avatars.com/api/?name=User&background=3b82f6&color=fff&size=200" alt="Avatar">
                                <div class="avatar-overlay" id="avatarOverlay"></div>
                            </div>
                            <input type="file" id="avatarInput" accept="image/*" style="display: none;">
                            <div class="avatar-actions-compact">
                                <button type="button" id="uploadAvatarBtn" class="btn btn-primary">Modifier</button>
                                <button type="button" id="removeAvatarBtn" class="btn btn-danger">Supprimer</button>
                            </div>
                        </div>
                    </div>

                    <!-- Form fields -->
                    <div class="settings-grid-2">
                        <!-- Email (Read-only) -->
                        <div class="form-group">
                            <label for="emailDisplay" class="form-label" data-i18n="settings.email">Email</label>
                            <input
                                type="email"
                                id="emailDisplay"
                                class="form-input"
                                disabled
                                readonly
                            >
                            <p class="form-hint" data-i18n="settings.emailHint">Adresse email de connexion (non modifiable)</p>
                        </div>

                        <!-- First Name (Obligatoire) -->
                        <div class="form-group">
                            <label for="firstNameInput" class="form-label">
                                <span data-i18n="settings.firstName">Prénom</span>
                                <span style="color: var(--error); margin-left: 0.25rem;">*</span>
                            </label>
                            <input
                                type="text"
                                id="firstNameInput"
                                class="form-input"
                                placeholder="John"
                                required
                            >
                            <p class="form-hint" data-i18n="settings.firstNameHint">Votre prénom</p>
                        </div>

                        <!-- Last Name (Obligatoire) -->
                        <div class="form-group">
                            <label for="lastNameInput" class="form-label">
                                <span data-i18n="settings.lastName">Nom</span>
                                <span style="color: var(--error); margin-left: 0.25rem;">*</span>
                            </label>
                            <input
                                type="text"
                                id="lastNameInput"
                                class="form-input"
                                placeholder="Doe"
                                required
                            >
                            <p class="form-hint" data-i18n="settings.lastNameHint">Votre nom de famille</p>
                        </div>

                        <!-- Country (Obligatoire) -->
                        <div class="form-group">
                            <label for="countrySelect" class="form-label">
                                <span data-i18n="settings.country">Pays</span>
                                <span style="color: var(--error); margin-left: 0.25rem;">*</span>
                            </label>
                            <select
                                id="countrySelect"
                                class="form-input"
                                required
                            >
                                <option value="">Sélectionnez un pays</option>
                            </select>
                            <p class="form-hint" data-i18n="settings.countryHint">Pays de résidence</p>
                        </div>

                        <!-- City (Obligatoire) -->
                        <div class="form-group">
                            <label for="cityInput" class="form-label">
                                <span data-i18n="settings.city">Ville</span>
                                <span style="color: var(--error); margin-left: 0.25rem;">*</span>
                            </label>
                            <input
                                type="text"
                                id="cityInput"
                                class="form-input"
                                placeholder="Paris"
                                required
                            >
                            <p class="form-hint" data-i18n="settings.cityHint">Ville de résidence</p>
                        </div>

                        <!-- Phone (Optionnel) -->
                        <div class="form-group">
                            <label for="phoneInput" class="form-label" data-i18n="settings.phone">Téléphone</label>
                            <div style="display: flex; gap: 0.5rem;">
                                <select id="phoneCountryCode" class="form-input" style="width: 120px;">
                                    <!-- Options peuplées dynamiquement depuis countries.js -->
                                </select>
                                <input
                                    type="tel"
                                    id="phoneInput"
                                    class="form-input"
                                    placeholder="6 12 34 56 78"
                                    style="flex: 1;"
                                >
                            </div>
                            <p class="form-hint" data-i18n="settings.phoneHint">Numéro de téléphone (optionnel)</p>
                        </div>

                        <!-- Bio (Optionnel) - Full width -->
                        <div class="form-group" style="grid-column: 1 / -1;">
                            <label for="bioInput" class="form-label" data-i18n="settings.bio">Biographie</label>
                            <textarea
                                id="bioInput"
                                class="form-input"
                                placeholder="Quelques mots sur vous..."
                                rows="3"
                                maxlength="500"
                                style="resize: vertical; min-height: 80px;"
                            ></textarea>
                            <p class="form-hint">
                                <span data-i18n="settings.bioHint">Courte présentation (optionnel)</span>
                                <span style="float: right;">
                                    <span id="bioCount">0</span>/500
                                </span>
                            </p>
                        </div>
                    </div>

                    <!-- Actions -->
                    <div class="profile-actions">
                        <button type="button" id="generateAvatarBtn" class="btn btn-success">
                            <span class="btn-text">Générer avatar aléatoire</span>
                        </button>
                        <button id="updateProfileBtn" class="btn btn-primary" data-i18n="settings.updateProfile" disabled>
                            Enregistrer les modifications
                        </button>
                    </div>
                </div>
            </section>

            <!-- Preferences Section -->
            <section id="section-preferences" class="settings-section">
                <h2 class="settings-section-title" data-i18n="settings.preferences">Préférences</h2>
                <p class="settings-section-desc" data-i18n="settings.managePreferences">Gérez vos catégories et pays favoris</p>

                <div class="preferences-grid-layout">
                    <!-- Categories Card -->
                    <div class="settings-card">
                        <h3 class="settings-card-title" data-i18n="settings.favoriteCategories">Catégories</h3>

                        <div class="preferences-list" id="categoriesGrid">
                            <div class="switch-item" data-category="general">
                                <span class="switch-item-label" data-i18n="category.general">Général</span>
                                <label class="switch">
                                    <input type="checkbox" data-category-switch="general">
                                    <span class="slider"></span>
                                </label>
                            </div>
                            <div class="switch-item" data-category="business">
                                <span class="switch-item-label" data-i18n="category.business">Business</span>
                                <label class="switch">
                                    <input type="checkbox" data-category-switch="business">
                                    <span class="slider"></span>
                                </label>
                            </div>
                            <div class="switch-item" data-category="technology">
                                <span class="switch-item-label" data-i18n="category.technology">Technologie</span>
                                <label class="switch">
                                    <input type="checkbox" data-category-switch="technology">
                                    <span class="slider"></span>
                                </label>
                            </div>
                            <div class="switch-item" data-category="science">
                                <span class="switch-item-label" data-i18n="category.science">Science</span>
                                <label class="switch">
                                    <input type="checkbox" data-category-switch="science">
                                    <span class="slider"></span>
                                </label>
                            </div>
                            <div class="switch-item" data-category="health">
                                <span class="switch-item-label" data-i18n="category.health">Santé</span>
                                <label class="switch">
                                    <input type="checkbox" data-category-switch="health">
                                    <span class="slider"></span>
                                </label>
                            </div>
                            <div class="switch-item" data-category="sports">
                                <span class="switch-item-label" data-i18n="category.sports">Sports</span>
                                <label class="switch">
                                    <input type="checkbox" data-category-switch="sports">
                                    <span class="slider"></span>
                                </label>
                            </div>
                            <div class="switch-item" data-category="entertainment">
                                <span class="switch-item-label" data-i18n="category.entertainment">Divertissement</span>
                                <label class="switch">
                                    <input type="checkbox" data-category-switch="entertainment">
                                    <span class="slider"></span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Countries Card -->
                    <div class="settings-card">
                        <h3 class="settings-card-title" data-i18n="settings.favoriteCountries">Pays</h3>

                        <div class="preferences-list" id="countriesGrid">
                            <div class="switch-item" data-country="us">
                                <span class="switch-item-label" data-i18n="country.us">États-Unis</span>
                                <label class="switch">
                                    <input type="checkbox" data-country-switch="us">
                                    <span class="slider"></span>
                                </label>
                            </div>
                            <div class="switch-item" data-country="fr">
                                <span class="switch-item-label" data-i18n="country.fr">France</span>
                                <label class="switch">
                                    <input type="checkbox" data-country-switch="fr">
                                    <span class="slider"></span>
                                </label>
                            </div>
                            <div class="switch-item" data-country="gb">
                                <span class="switch-item-label" data-i18n="country.gb">Royaume-Uni</span>
                                <label class="switch">
                                    <input type="checkbox" data-country-switch="gb">
                                    <span class="slider"></span>
                                </label>
                            </div>
                            <div class="switch-item" data-country="ca">
                                <span class="switch-item-label" data-i18n="country.ca">Canada</span>
                                <label class="switch">
                                    <input type="checkbox" data-country-switch="ca">
                                    <span class="slider"></span>
                                </label>
                            </div>
                            <div class="switch-item" data-country="de">
                                <span class="switch-item-label" data-i18n="country.de">Allemagne</span>
                                <label class="switch">
                                    <input type="checkbox" data-country-switch="de">
                                    <span class="slider"></span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Account Section -->
            <section id="section-account" class="settings-section">
                <h2 class="settings-section-title">Compte</h2>
                <p class="settings-section-desc">Gérez les paramètres de votre compte</p>

                <div class="settings-card">
                    <div class="form-fields-group">
                        <div class="form-group">
                            <label class="form-label" data-i18n="settings.languagePreferences">Préférences de langue</label>
                            <select id="languageSelect" class="form-input">
                                <option value="fr" data-i18n="settings.french">Français</option>
                                <option value="en" data-i18n="settings.english">English</option>
                            </select>
                            <p class="form-hint" data-i18n="settings.languageHint">Langue de l'interface</p>
                        </div>

                        <div class="form-group">
                            <label class="form-label" data-i18n="settings.theme">Thème</label>
                            <select id="themeSelect" class="form-input" data-manual-theme>
                                <option value="light" data-i18n="settings.light">Clair</option>
                                <option value="dark" data-i18n="settings.dark">Sombre</option>
                            </select>
                            <p class="form-hint" data-i18n="settings.themeHint">Apparence de l'application</p>
                        </div>
                    </div>

                    <button id="saveAccountBtn" class="btn btn-primary" data-i18n="settings.savePreferences">
                        Enregistrer les préférences
                    </button>
                </div>

                <div class="settings-card" style="margin-top: 2rem; border-color: var(--error);">
                    <h3 style="color: var(--error); margin-bottom: 0.5rem;" data-i18n="settings.dangerZone">Zone de danger</h3>
                    <p class="settings-description" data-i18n="settings.dangerZoneDesc">
                        Une fois votre compte supprimé, toutes vos données seront définitivement effacées. Cette action est irréversible.
                    </p>
                    <button id="deleteAccountBtn" class="btn btn-danger" data-i18n="settings.deleteAccount">
                        Supprimer mon compte
                    </button>
                </div>
            </section>

            <!-- Security Section -->
            <section id="section-security" class="settings-section">
                <h2 class="settings-section-title" data-i18n="settings.security">Sécurité</h2>
                <p class="settings-section-desc" data-i18n="settings.protectAccount">Protégez votre compte</p>

                <div class="security-grid">
                    <div class="settings-card">
                        <h3 style="font-size: 1rem; font-weight: 600; margin-bottom: 1rem; color: var(--text-primary);" data-i18n="settings.changePassword">Changement de mot de passe</h3>
                        <div class="form-fields-group">
                            <div class="form-group">
                                <label for="currentPassword" class="form-label" data-i18n="settings.currentPassword">Mot de passe actuel</label>
                                <input
                                    type="password"
                                    id="currentPassword"
                                    class="form-input"
                                    placeholder="••••••••••••••••••••••••"
                                    data-i18n-placeholder="settings.currentPasswordPlaceholder"
                                >
                                <p class="form-hint" data-i18n="settings.currentPasswordHint">Entrez votre mot de passe actuel</p>
                            </div>

                            <div class="form-group">
                                <label for="newPassword" class="form-label" data-i18n="settings.newPassword">Nouveau mot de passe</label>
                                <input
                                    type="password"
                                    id="newPassword"
                                    class="form-input"
                                    placeholder="••••••••••••••••••••••••"
                                    data-i18n-placeholder="settings.newPasswordPlaceholder"
                                >
                                <p class="form-hint" data-i18n="settings.newPasswordHint">Minimum 12 caractères</p>
                            </div>

                            <div class="form-group">
                                <label for="confirmPassword" class="form-label" data-i18n="settings.confirmPassword">Confirmer le mot de passe</label>
                                <input
                                    type="password"
                                    id="confirmPassword"
                                    class="form-input"
                                    placeholder="••••••••••••••••••••••••"
                                    data-i18n-placeholder="settings.confirmPasswordPlaceholder"
                                >
                                <p class="form-hint" data-i18n="settings.confirmPasswordHint">Retapez votre nouveau mot de passe</p>
                            </div>
                        </div>

                        <button id="changePasswordBtn" class="btn btn-primary" data-i18n="settings.changePasswordBtn">
                            Changer le mot de passe
                        </button>
                    </div>

                    <!-- Security Audit Card -->
                    <div class="settings-card">
                        <h3 style="font-size: 1rem; font-weight: 600; margin-bottom: 0.75rem; color: var(--text-primary);" data-i18n="settings.securityAudit">Audit de sécurité</h3>
                        <p class="settings-description" data-i18n="settings.securityAuditDesc">
                            Changements de mot de passe, modifications de profil et activités suspectes
                        </p>
                        <div id="securityAuditContainer" style="margin-bottom: 1rem;">
                            <p style="text-align: center; color: var(--text-muted);" data-i18n="settings.loadingAudit">Chargement de l'audit...</p>
                        </div>
                        <button id="clearAuditLogsBtn" class="btn btn-danger btn-full-width">
                            Effacer l'historique
                        </button>
                    </div>

                    <!-- Active Sessions Card -->
                    <div class="settings-card">
                        <h3 style="font-size: 1rem; font-weight: 600; margin-bottom: 0.75rem; color: var(--text-primary);">Dernières connexions</h3>
                        <p class="settings-description">
                            Historique des 3 dernières connexions par IP avec géolocalisation
                        </p>
                        <div id="activeSessionsContainer">
                            <p style="text-align: center; color: var(--text-muted);">Chargement des connexions...</p>
                        </div>
                        <button id="logoutAllDevicesBtn" class="btn btn-danger btn-full-width btn-mt-1">
                            Déconnecter tous les appareils
                        </button>
                    </div>
                </div>
            </section>

        </div>
    </div>

    <!-- Delete Account Confirmation Modal -->
    <div class="modal-overlay" id="deleteAccountModal">
        <div class="modal-container">
            <button class="modal-close" id="closeDeleteModal">&times;</button>

            <div class="modal-content">
                <h2 class="modal-title" style="color: var(--error);">⚠️ Supprimer mon compte</h2>
                <p class="modal-subtitle" data-i18n="settings.deleteAccountWarning">
                    Cette action est irréversible et supprimera définitivement :
                </p>

                <div style="margin: 1.5rem 0; padding: 1rem; background: var(--bg-secondary); border-radius: var(--radius-md); border-left: 3px solid var(--error);">
                    <ul style="margin: 0; padding-left: 1.25rem; color: var(--text-secondary); line-height: 1.8;">
                        <li>Votre compte et toutes vos informations personnelles</li>
                        <li>Vos préférences et paramètres</li>
                        <li>Votre historique et vos données</li>
                        <li>Votre accès à l'application</li>
                    </ul>
                </div>

                <p style="color: var(--text-secondary); margin-bottom: 1.5rem; font-size: 0.9375rem;">
                    <strong style="color: var(--error);">ATTENTION :</strong> Cette action ne peut pas être annulée. Toutes vos données seront perdues définitivement.
                </p>

                <div id="deleteAccountError" class="error-message" style="display: none;"></div>

                <div class="button-group">
                    <button type="button" class="btn btn-primary btn-half" id="cancelDeleteBtn">
                        Annuler
                    </button>
                    <button type="button" class="btn btn-danger btn-half" id="confirmDeleteBtn">
                        Supprimer définitivement
                    </button>
                </div>
            </div>
        </div>
    </div>


    <script type="module" src="./public/js/settings-main.js"></script>
</body>
</html>
