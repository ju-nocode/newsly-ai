<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Newsly AI - ActualitÃ©s</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸ“°</text></svg>">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="public/css/dashboard-main.css">
    <script src="public/js/browser-detect.js"></script>
    <script src="public/js/icons-theme.js"></script>
</head>
<body class="dashboard-body">

    <!-- Simple public banner -->
    <div class="public-banner" id="publicBanner" style="display: none;">
        <div class="public-banner-text">
            Connectez-vous pour personnaliser vos actualitÃ©s
        </div>
        <div class="public-banner-buttons">
            <a href="dashboard.html" class="public-banner-btn">Connexion</a>
        </div>
    </div>

    <!-- Simple navbar without search -->
    <nav class="navbar dashboard-nav">
        <div class="nav-container">
            <div class="nav-left">
                <a href="index.html" class="logo">
                    <img src="https://img.icons8.com/ios/24/news.png" alt="News" class="logo-icon icon-primary">
                    <span class="logo-text">Newsly AI</span>
                </a>
            </div>
            <div class="nav-right">
                <a href="dashboard.html" class="btn btn-primary" style="padding: 0.5rem 1rem;">Connexion</a>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="dashboard-container" style="margin-left: 0;">
        <main class="dashboard-main">
            <div class="news-header">
                <h1 id="categoryTitle">ActualitÃ©s GÃ©nÃ©rales</h1>
            </div>

            <div id="newsContainer" class="news-grid">
                <!-- Les actualitÃ©s seront chargÃ©es ici -->
            </div>
        </main>
    </div>

    <script type="module">
        import { checkAuth } from './public/js/app.js';
        import { displayNews } from './public/js/dashboard-utils.js';

        const publicBanner = document.getElementById('publicBanner');
        const newsContainer = document.getElementById('newsContainer');

        // Smart redirect
        (async () => {
            console.log('ðŸš€ Index.html loading...');

            // Check if authenticated â†’ redirect to dashboard
            const isAuthenticated = checkAuth();

            if (isAuthenticated) {
                console.log('âœ… User authenticated â†’ Redirecting to dashboard.html');
                window.location.href = 'dashboard.html';
                return;
            }

            // NOT AUTHENTICATED â†’ Show public mode
            console.log('ðŸ“– Public mode');
            publicBanner.style.display = 'flex';

            // Show loading
            newsContainer.innerHTML = `
                <div class="shimmer-card"></div>
                <div class="shimmer-card"></div>
                <div class="shimmer-card"></div>
                <div class="shimmer-card"></div>
                <div class="shimmer-card"></div>
                <div class="shimmer-card"></div>
            `;

            try {
                // Try to fetch public news
                const controller = new AbortController();
                const timeout = setTimeout(() => controller.abort(), 5000);

                const response = await fetch('/api/news/public?category=general&country=us&page=1', {
                    signal: controller.signal
                });

                clearTimeout(timeout);

                if (response.ok) {
                    const data = await response.json();
                    console.log('ðŸ“° Got news:', data);

                    if (data.success && data.articles && data.articles.length > 0) {
                        displayNews(data.articles, 'newsContainer');
                        return;
                    }
                }
            } catch (error) {
                console.warn('API error:', error.message);
            }

            // Fallback: show welcome message
            newsContainer.innerHTML = `
                <div style="grid-column: 1 / -1; text-align: center; padding: 3rem 1rem;">
                    <h2 style="color: var(--text-primary); margin-bottom: 1rem;">Bienvenue sur Newsly AI</h2>
                    <p style="color: var(--text-secondary); margin-bottom: 2rem;">
                        Connectez-vous pour accÃ©der aux actualitÃ©s personnalisÃ©es
                    </p>
                    <a href="dashboard.html" class="btn btn-primary" style="padding: 0.6rem 1.5rem;">
                        Se connecter
                    </a>
                </div>
            `;
        })();
    </script>
</body>
</html>
